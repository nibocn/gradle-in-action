def getMavenSettingsCredentials = {
    String userHome = System.getProperty('user.home')
    File mavenSettings = new File(userHome, '.m2/settings2.xml')
    XmlSlurper xmlSlurper = new XmlSlurper()
    xmlSlurper.parse(mavenSettings)
}

task printAppServerHome {
    doLast {
        def env = project.hasProperty('env') ? project.getProperty('env') : 'dev'
        logger.quiet "Using environment '$env'"
        def settings = getMavenSettingsCredentials()
        def allProfiles = settings.profiles.profile
        def profile = allProfiles.find {
            it.activation.property.name == 'env' &&
                it.activation.property.value == env
        }
        def appServerHome = profile.properties.'appserver.home'
        println "The $env server's home directory: $appServerHome"
    }
}
